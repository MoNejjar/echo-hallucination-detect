%% Refined Architecture Diagram
flowchart TB
    subgraph Client[React Frontend]
        UI[UI Components]
        Editor[Prompt Editor]
        Viz[Risk Visualization]
        Chat[Dialogue Interface]
    end
    
    subgraph Server[FastAPI Backend]
        Routes[API Routes]
        Facade[LLM Facade]
    end
    
    subgraph Agents[LLM Service]
        Analyzer[Analyzer Agent]
        Conversation[Conversation Agent]
    end
    
    subgraph External[External Services]
        OpenAI[LLM]
    end
    
    %% Connections
    UI --> Editor
    Editor --> Routes
    Routes --> Facade
    Routes --> Chat
    Facade --> Analyzer
    Facade --> Conversation
    Analyzer --> OpenAI
    Conversation --> OpenAI
    OpenAI --> Analyzer
    OpenAI --> Conversation
    Analyzer --> Routes
    Conversation --> Routes
    Routes --> Viz

    
    style Client fill:#002147,stroke:#764ba2,stroke-width:3px,color:#ffffff
    style Server fill:#002147,stroke:#f5576c,stroke-width:3px,color:#ffffff
    style Agents fill:#002147,stroke:#00f2fe,stroke-width:3px,color:#ffffff
    style External fill:#002147,stroke:#38f9d7,stroke-width:3px,color:#ffffff

    
    linkStyle default stroke:#5B7C99,stroke-width:2px,color:#5B7C99
